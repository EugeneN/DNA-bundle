{emitter} = require 'event-channel'


ev_channel_protocol = [
    ['pub', ['ev', 'args']]
    ['sub', ['ev', 'handler']]
]


ev_channel_impl = ->
    pub: (ev, args) -> emitter.pub ev, args
    sub: (ev, handler) ->
        if ev instanceof Function
            emitter.sub ev(), handler # DNA returns monadic value that is function.
        else
            emitter.sub ev, handler


module.exports =
    protocols:
        definitions:
            EventChannel: ev_channel_protocol
        implementations:
            EventChannel: ev_channel_impl
